{"pageProps":{"post":{"mdxSource":"var Component=(()=>{var p=Object.create;var t=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var i=a=>t(a,\"__esModule\",{value:!0});var N=(a,s)=>()=>(s||a((s={exports:{}}).exports,s),s.exports),k=(a,s)=>{i(a);for(var c in s)t(a,c,{get:s[c],enumerable:!0})},g=(a,s,c)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let n of h(s))!u.call(a,n)&&n!==\"default\"&&t(a,n,{get:()=>s[n],enumerable:!(c=d(s,n))||c.enumerable});return a},f=a=>g(i(t(a!=null?p(m(a)):{},\"default\",a&&a.__esModule&&\"default\"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var o=N((S,r)=>{r.exports=_jsx_runtime});var I={};k(I,{default:()=>y,frontmatter:()=>w});var e=f(o()),w={title:\"Distributed Tracing With OpenTelemetry and Jaeger In Spring Boot\\xA03\",author:\"Amrut Prabhu\",categories:\"\",tags:[\"Distributed Tracing\",\"Spring Boot\",\"Java\",\"Jaeger\"],\"photo-credits\":null,\"applaud-link\":\"2021/spring-boot-stream-kafka.json\",date:\"2023-05-11\",draft:!1,summary:\"In this article, we will look at how we can export distributed traces using Opentelemetry to Jaeger from a Spring Boot Application\",imageUrl:\"/static/images/2023/distributed-tracing-opentelemetry-jaeger/cover.jpg\",actualUrl:\"auto-generated\",customUrl:\"auto-generated\"};function b(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(c,{})})):c();function c(){let n=Object.assign({p:\"p\",a:\"a\",h2:\"h2\",span:\"span\",ul:\"ul\",li:\"li\",pre:\"pre\",code:\"code\",div:\"div\",strong:\"strong\"},a.components),{Image:l}=n;return l||v(\"Image\",!0),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.p,{children:[\"In my previous article \\u201C\",(0,e.jsx)(n.a,{href:\"https://refactorfirst.com/distributed-tracing-spring-boot-opentracing-jaeger\",children:\"Distributed Tracing With Spring Cloud Jaeger\"}),\"\\u201D, we had seen how we can collect distributed traces from a Spring Boot application using Opentracing.\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"If you are not familiar with distributed tracing, you can read \",(0,e.jsx)(n.a,{href:\"https://refactorfirst.com/distributed-tracing-with-spring-cloud-sleuth.html\",children:\"this\"}),\" article wherein I have explained what are traces and spans in distributed systems.\"]}),`\n`,(0,e.jsx)(n.p,{children:\"The Opentracing project has been archived, as a result of it being merged with OpenCensus to form a single universal framework for application tracing and metrics.\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"This new framework is called \",(0,e.jsx)(n.a,{href:\"https://opentelemetry.io/docs/what-is-opentelemetry/\",children:\"OpenTelemetry\"}),\".\"]}),`\n`,(0,e.jsx)(n.p,{children:\"OpenTelemetry (OTel) is an open-source framework for collecting and analyzing observability data, like traces and metrics, from distributed systems. It provides APIs and libraries for developers to instrument their applications, gain insights into system performance, and integrate with various observability tools.\"}),`\n`,(0,e.jsx)(n.p,{children:\"Let\\u2019s look at how we can send distributed traces to Jaeger using Opentelemetry.\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"creating-an-application\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#creating-an-application\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Creating an application\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Let\\u2019s go to \",(0,e.jsx)(n.a,{href:\"https://start.spring.io\",children:\"https://start.spring.io\"}),\" and create an application with the following dependencies.\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"Spring Web (required to create REST endpoints)\"}),`\n`,(0,e.jsx)(n.li,{children:\"Spring Boot Actuator\"}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"We will be using the micrometer collector in the actuator dependency to collect the traces and then use the OpenTelemetry dependency to export the traces.\"}),`\n`,(0,e.jsx)(n.p,{children:\"For this, we would need to add the following dependencies.\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-xml\",children:(0,e.jsxs)(n.code,{className:\"language-xml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" \",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"<\"}),\"dependency\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"     \",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"<\"}),\"groupId\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\">\"})]}),\"io.micrometer\",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"</\"}),\"groupId\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"     \",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"<\"}),\"artifactId\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\">\"})]}),\"micrometer-tracing-bridge-otel\",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"</\"}),\"artifactId\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"</\"}),\"dependency\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"<\"}),\"dependency\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"     \",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"<\"}),\"groupId\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\">\"})]}),\"io.opentelemetry\",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"</\"}),\"groupId\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"     \",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"<\"}),\"artifactId\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\">\"})]}),\"opentelemetry-exporter-otlp\",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"</\"}),\"artifactId\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"</\"}),\"dependency\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"The dependency versions will be taken care of by the Spring Boot parent.\"}),`\n`,(0,e.jsx)(n.p,{children:\"Next, we will create two endpoints in our application in the Controller class.\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-java\",children:(0,e.jsxs)(n.code,{className:\"language-java code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"RestTemplate\"}),\" restTemplate\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token annotation punctuation\",children:\"@Value\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"${spring.application.name}\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"private\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"String\"}),\" applicationName\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Controller\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"RestTemplate\"}),\" restTemplate\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"this\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"restTemplate \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" restTemplate\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token annotation punctuation\",children:\"@GetMapping\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"/path1\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"ResponseEntity\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"path1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        logger\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"info\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Incoming request at {} for request /path1 \"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" applicationName\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"String\"}),\" response \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" restTemplate\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"getForObject\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"http://localhost:8090/service/path2\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"String\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"class\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"ResponseEntity\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"ok\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"response from /path1 + \"'}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" response\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token annotation punctuation\",children:\"@GetMapping\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"/path2\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"public\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"ResponseEntity\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"path2\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        logger\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"info\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Incoming request at {} at /path2\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" applicationName\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"ResponseEntity\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"ok\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"response from /path2 \"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"The idea here is to run the same application two times with different ports, such that one application calls the other applications on a different path.\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"When we invoke the \",(0,e.jsx)(n.code,{children:\"/path1\"}),\" endpoint, it will further call the \",(0,e.jsx)(n.code,{children:\"/path2\"}),\" endpoint on the predefined port 8090 of the server running on localhost.\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Now to export the spans to Jaeger, we need to create a span exporter bean as follows.\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-java\",children:(0,e.jsxs)(n.code,{className:\"language-java code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token annotation punctuation\",children:\"@Bean\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token class-name\",children:\"OtlpHttpSpanExporter\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"otlpHttpSpanExporter\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token annotation punctuation\",children:\"@Value\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"${tracing.url}\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"String\"}),\" url\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"OtlpHttpSpanExporter\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"builder\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"setEndpoint\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"url\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"build\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"Along with this, we will define the Jaeger URL in the properties file to which the traces are to be reported.\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"spring\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"application\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` app\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"tracing\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"url\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" http\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"//localhost\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`4318/v1/traces\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"management\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"tracing\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"sampling\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"probability\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1.0\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"logging\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"pattern\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"level\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'%5p [${spring.application.name:},%X{traceId:-},%X{spanId:-}]'\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"Now here we are setting the probability of sampling the tracing to 1 so that every trace and span is reported to Jaeger.\"}),`\n`,(0,e.jsx)(n.p,{children:\"We will also provide a custom logging format, so we can see the spans and traces in the application logs.\"}),`\n`,(0,e.jsx)(n.p,{children:\"Now, before we start the application, let\\u2019s start Jaeger using docker-compose.\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"starting-jaeger-with-docker\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#starting-jaeger-with-docker\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Starting Jaeger with Docker\"]}),`\n`,(0,e.jsx)(n.p,{children:\"To start Jaeger, we have the following docker-compose file.\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"version\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'3.9'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"services\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"jaeger\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"image\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" jaegertracing/all\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"in\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"one\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`latest\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"ports\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" 4318\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"4318\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" 16686\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"16686\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token key atrule\",children:\"environment\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),` COLLECTOR_OTLP_ENABLED=true\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"For Jaeger to support the OpenTelemetry input format, we need to set the \",(0,e.jsx)(n.code,{children:\"COLLECTOR_OTLP_ENABLED\"}),\" to \",(0,e.jsx)(n.code,{children:\"true\"})]}),`\n`,(0,e.jsx)(n.p,{children:\"With this, let's start the application as two separate instances on different ports.\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"java -jar \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"target/Distributed-Service-0.0.1-SNAPSHOT.jar \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"--spring.application.name\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"Service-1 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"--server.port\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"8080\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"java -jar \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"target/Distributed-Service-0.0.1-SNAPSHOT.jar \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"--spring.application.name\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"Service-2 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"--server.port\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"8090\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Once the two applications are up and running, we call the endpoint \",(0,e.jsx)(n.code,{children:\"/path1\"}),\" on the first server.\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"curl\"}),` localhost:8080/service/path1\n`]})})}),`\n`,(0,e.jsx)(n.p,{children:\"Now, let\\u2019s visualize the traces in Jaeger UI.\"}),`\n`,(0,e.jsx)(n.p,{children:\"To access the Jaeger UI, open the following URL.\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`http://localhost:16686/\n`})})}),`\n`,(0,e.jsx)(n.p,{children:\"When we select the service and click find traces, we will see the traces in the UI.\"}),`\n`,(0,e.jsx)(n.div,{children:(0,e.jsx)(l,{alt:\"Jaeger UI\",src:\"/static/images/2023/distributed-tracing-opentelemetry-jaeger/jaeger-ui.png\",width:\"1076\",height:\"794\"})}),`\n`,(0,e.jsx)(n.p,{children:\"Let\\u2019s open the trace and see the various spans of the request.\"}),`\n`,(0,e.jsx)(n.div,{children:(0,e.jsx)(l,{alt:\"Traces and spans\",src:\"/static/images/2023/distributed-tracing-opentelemetry-jaeger/trace-and-spans.png\",width:\"1078\",height:\"875\"})}),`\n`,(0,e.jsx)(n.p,{children:\"Here we can see the various span and how much time each span took along with span id. You can correlate the spans with the log lines of each of the services as shown below.\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`Service-1 log:\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"INFO \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"Service-1,9b888edfe46d05bfe3bd06f690bff0af,012c9c0ff054e356\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"17505\"}),\" --- \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"nio-8080-exec-2\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" com.amrut.prabhu.Controller: Incoming request at Service-1 \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),` request /path1\n`]})]})}),`\n`,(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`Service-2 log:\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"INFO \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"Service-2,9b888edfe46d05bfe3bd06f690bff0af,cf99518ce5d57ac9\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"22322\"}),\" --- \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"nio-8090-exec-1\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),` com.amrut.prabhu.Controller: Incoming request at Service-2 at /path2\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"You can find the complete code on my GitHub repository \",(0,e.jsx)(n.a,{href:\"https://github.com/amrutprabhu/distributed-tracing-with-spring-boot/tree/main/distributed-tracing-spring-boot-opentelemetry-jaeger\",children:\"here\"}),\".\"]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.strong,{children:\"Next \\u2026\"})}),`\n`,(0,e.jsx)(n.p,{children:\"If you\\u2019re interested in exploring more articles related to software development, here are some more recommendations:\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://refactorfirst.com/3-ways-to-create-spring-boot-docker-images\",children:(0,e.jsx)(n.strong,{children:\"3 Ways to Create Spring Boot Docker Images Without Docker File\"})})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://refactorfirst.com/spring-cloud-stream-with-kafka-communication\",children:(0,e.jsx)(n.strong,{children:\"Using Spring Cloud Stream With Kafka\"})})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://refactorfirst.com/kind-kubernetes-cluster\",children:(0,e.jsx)(n.strong,{children:\"Kind\\u200A\\u2014\\u200AA New Kubernetes Cluster\"})})}),`\n`]}),`\n`,(0,e.jsxs)(n.p,{children:[\"I keep exploring and learning new things. If you want to know the latest trends and improve your software development skills, then subscribe to my newsletter below and also follow me on \",(0,e.jsx)(n.a,{href:\"https://twitter.com/amrutprabhu42\",children:\"Twitter\"}),\".\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Enjoy!!\"})]})}}var y=b;function v(a,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return I;})();\n;return Component;","toc":[{"value":"Creating an application","url":"#creating-an-application","depth":2},{"value":"Starting Jaeger with Docker","url":"#starting-jaeger-with-docker","depth":2}],"frontMatter":{"readingTime":{"text":"6 min read","minutes":5.855,"time":351300,"words":1171},"slug":"2023/distributed-tracing-with-opentelemetry-jaeger-in-spring-boot","fileName":"2023/distributed-tracing-with-opentelemetry-jaeger-in-spring-boot.md","title":"Distributed Tracing With OpenTelemetry and Jaeger In Spring Boot 3","author":"Amrut Prabhu","categories":"","tags":["Distributed Tracing","Spring Boot","Java","Jaeger"],"photo-credits":null,"applaud-link":"2021/spring-boot-stream-kafka.json","date":"2023-05-11T00:00:00.000Z","draft":false,"summary":"In this article, we will look at how we can export distributed traces using Opentelemetry to Jaeger from a Spring Boot Application","imageUrl":"/static/images/2023/distributed-tracing-opentelemetry-jaeger/cover.jpg","actualUrl":"2023/distributed-tracing-with-opentelemetry-jaeger-in-spring-boot","customUrl":"distributed-tracing-with-opentelemetry-jaeger-in-spring-boot"}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.74,"time":44400,"words":148},"slug":["default"],"fileName":"default.md","name":"Amrut Prabhu","avatar":"/static/images/avatar-small.jpg","avatarBig":"/static/images/avatar-big.jpg","occupation":"","company":"","email":"contact@refactorfirst.com","twitter":"https://twitter.com/amrutprabhu42","linkedin":"","github":"","customUrl":"default","actualUrl":"default","date":null}],"prev":{"title":"Spring Boot With MongoDB Using Spring Data","author":"Amrut Prabhu","categories":"","tags":["MongoDB","Spring Boot","Spring Data","Mongo Express","NoSQL"],"photo-credits":null,"applaud-link":"2021/spring-boot-stream-kafka.json","date":"2023-05-04T00:00:00.000Z","draft":false,"summary":"In this article, we will look at how we can start a local MongoDB instance using Docker and then communicate with it using a Spring Boot Application","imageUrl":"/static/images/2023/connect-mongodb-with-spring-boot/cover.jpg","actualUrl":"2023/spring-boot-with-mongodb-using-spring-data","customUrl":"spring-boot-with-mongodb-using-spring-data","slug":"spring-boot-with-mongodb-using-spring-data"},"next":{"title":"Spring Cloud AWS 3.0 S3 with Spring Boot and Localstack","author":"Amrut Prabhu","categories":"","tags":["Spring Boot","AWS","AWS S3","Spring Cloud","Spring Clous AWS"],"photo-credits":null,"applaud-link":"2021/spring-boot-stream-kafka.json","date":"2023-05-25T00:00:00.000Z","draft":false,"summary":"In this article, we will look into how we can use Spring Cloud AWS S3 in a Spring Boot Application to communicate with AWS. We will run our setup with LocalStack to mock the actual AWS S3 service","imageUrl":"/static/images/2023/spring-cloud-aws-s3-localstack/cover.jpg","actualUrl":"2023/spring-cloud-aws-s3-localstack","customUrl":"spring-cloud-aws-s3-localstack","slug":"spring-cloud-aws-s3-localstack"}},"__N_SSG":true}